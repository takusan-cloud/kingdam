<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚­ãƒ³ã‚°ãƒ€ãƒ é ‚å¤© æ•°å­—åˆã‚ã›</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: url('bg.jpg') no-repeat center top;
      background-size: cover;
      color: white;
    }

    h1 {
      font-size: 2.5rem;
      font-weight: bold;
      color: red;
      text-shadow: 2px 2px 0 black;
      text-align: center;
      margin: 10px 0;
    }

    .tabs {
      display: flex;
      justify-content: flex-start;
      gap: 10px;
      margin: 10px;
    }
    .tab {
      padding: 8px 16px;
      border: none;
      background: rgba(255,255,255,0.2);
      color: white;
      cursor: pointer;
      border-radius: 6px 6px 0 0;
    }
    .tab.active {
      background: white;
      color: black;
      font-weight: bold;
    }
    .tab-content {
      display: none;
      padding: 10px;
      border-radius: 0 6px 6px 6px;
      margin: 0 10px;
    }

    .container {
      display: flex;
      justify-content: flex-start;
      gap: 20px;
      margin: 10px;
    }

    .section {
      background: rgba(0,0,0,0.7);
      padding: 10px;
      border-radius: 10px;
    }

    #members {
      display: flex;
      justify-content: flex-start;
      flex-wrap: wrap;
      gap: 20px;
      margin-left: 10px;
    }

    .member-block {
      background: rgba(0,0,0,0.7);
      padding: 10px;
      border-radius: 10px;
      width: 220px;
      box-sizing: border-box;
    }

    .member-block h2 {
      margin: 6px 0;
      font-size: 1.05rem;
      text-align: left;
    }

    .nameInput {
      display: block;
      width: 95%;
      text-align: center;
      padding: 6px;
      border-radius: 6px;
      border: none;
      background: rgba(255,255,255,0.1);
      color: white;
      margin: 5px auto 10px auto;
      box-sizing: border-box;
    }

    .powers {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
    }
    .powerInput {
      padding: 6px;
      border-radius: 6px;
      border: none;
      background: rgba(255,255,255,0.04);
      color: white;
      text-align: center;
      width: 100%;
      box-sizing: border-box;
    }

    .check-btn {
      display: block;
      margin: 10px 0;
      padding: 10px 20px;
      font-size: 1.2rem;
      background: white;
      color: black;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .add-btn, .remove-btn, .save-btn {
      display: block;
      margin: 5px 0;
      padding: 5px 15px;
      font-size: 1rem;
      background: white;
      color: black;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    /* è–„ã„é»„è‰²é€éã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
    .highlight {
      border: 2px solid red !important;
      background: rgba(255, 255, 0, 0.4) !important;
    }

    /* ã‚»ãƒªãƒ•ç”¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    @keyframes serifuPop {
      0% { opacity: 0; transform: scale(0.8); }
      60% { opacity: 1; transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    #result.animate {
      animation: serifuPop 0.6s ease;
    }

    #result {
      font-size: 2rem;
      font-weight: bold;
      text-align: center;
      margin: 20px auto;
    }

    #saveMessage {
      display: none;
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      opacity: 0;
      transform: translateY(-10px);
      transition: opacity 0.4s ease, transform 0.4s ease;
      z-index: 999;
    }
    #saveMessage.show {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    #info {
      background: rgba(0,0,0,0.8);
      text-align: left;
      padding: 14px;
    }
    #info img {
      max-width: 20%;
      border-radius: 8px;
      border: 2px solid white;
      margin-right: 10px;
      vertical-align: middle;
      display: inline-block;
    }
    #info .caption {
      display: inline-block;
      vertical-align: middle;
      font-weight: bold;
      margin-left: 6px;
    }

    @media (max-width: 768px) {
      .member-block {
        width: 90%;
      }
      #info img {
        max-width: 50%;
        display: block;
        margin-bottom: 8px;
      }
    }
  </style>
</head>
<body>
  <h1>ã‚­ãƒ³ã‚°ãƒ€ãƒ é ‚å¤© æ•°å­—åˆã‚ã›</h1>

  <div class="tabs">
    <button class="tab active" onclick="showTab('calc')">è¨ˆç®—</button>
    <button class="tab" onclick="showTab('info')">èª¬æ˜</button>
  </div>

  <div id="calc" class="tab-content" style="display:block;">
    <div class="container">
      <div class="section">
        <label>è¡¨ç¤ºã—ãŸã„æˆ¦åŠ›<br>
          <input id="targetPower" type="text" placeholder="400000000">
        </label><br>
        <label>é…ç½®æ¸ˆã¿ã®æˆ¦åŠ›<br>
          <input id="placedPower" type="text" placeholder="300000000">
        </label>
      </div>
    </div>

    <div class="container">
      <div>
        <button class="check-btn" onclick="checkCombination()">ãƒã‚§ãƒƒã‚¯</button>
        <button class="add-btn" onclick="addMember()">ï¼‹æ­¦å°†è¿½åŠ </button>
        <button class="remove-btn" onclick="removeMember()" style="display:none;">âˆ’æ­¦å°†å‰Šé™¤</button>
        <button class="save-btn" onclick="saveData()">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ä¿å­˜</button>
      </div>
    </div>

    <div id="members"></div>
    <div id="result">ä¸€è‡´ãªã—</div>
  </div>

  <div id="info" class="tab-content">
    <h2>ä½¿ã„æ–¹</h2>
    <p>ã€Œè¡¨ç¤ºã—ãŸã„æˆ¦åŠ›ã€ã«ç›®æ¨™ã®æˆ¦åŠ›ã‚’å…¥åŠ›ã—ã¾ã™ã€‚</p>
    <p>ã€Œé…ç½®æ¸ˆã¿ã®æˆ¦åŠ›ã€ã«æ•°å­—åˆã‚ã›ã§ä½¿ç”¨ã—ãªã„æ­¦å°†ã‚’é…ç½®ã—ãŸéš›ã®æˆ¦åŠ›ã‚’å…¥åŠ›ã—ã¾ã™ã€‚<br>
    ï¼ˆæ•°å­—åˆã‚ã›ã§ä½¿ç”¨ã™ã‚‹ã®ãŒï¼“ä½“ã§ã‚ã‚Œã°ï¼—ä½“é…ç½®ã—ãŸæˆ¦åŠ›ã«ãªã‚Šã¾ã™ã€‚ï¼‰</p>

    <img src="screenshot1.png" alt="å…¥åŠ›ä¾‹">
    <span class="caption">â¬… èµ¤æ å†…ã®æ•°å­—ã‚’ã€Œé…ç½®æ¸ˆã¿ã®æˆ¦åŠ›ã€ã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚å‰¯å°†ï¼“äººã§æ•°å­—åˆã‚ã›ã™ã‚‹å ´åˆã®å…¥åŠ›ä¾‹ã§ã™ã€‚</span>

    <p>æ­¦å°†1ã€œ3ã®æˆ¦åŠ›ã‚’å…¥åŠ›ã—ã¾ã™ã€‚<br>
    â€»å‰¯å°†ã§æ•°å­—åˆã‚ã›ã™ã‚‹å ´åˆã¯å®Ÿéš›ã«é…ç½®ã—ãŸæˆ¦åŠ›ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br>
    ï¼ˆãªãœã‹æˆ¦åŠ›ã®åŠåˆ†ã«ãªã‚‰ãªã„ãŸã‚ãƒ»ãƒ»ãƒ»ï¼‰</p>

    <p>å¿…è¦ãªã‚‰ã€Œï¼‹æ­¦å°†è¿½åŠ ã€ã§æ­¦å°†4ã‚‚è¿½åŠ å¯èƒ½ã§ã™ã€‚</p>
    <p>ã€Œãƒã‚§ãƒƒã‚¯ã€ã‚’æŠ¼ã™ã¨ã€å…¨ã¦ã®çµ„ã¿åˆã‚ã›ã‹ã‚‰ç›®æ¨™ã«ä¸€è‡´ã™ã‚‹ã‚‚ã®ã‚’æ¢ã—ã¾ã™ã€‚<br>
    ä¸€è‡´ã—ãŸå ´åˆã¯æ¾¤ã•ã‚“ã®åè¨€ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼ï¼</p>

    <p>å¿œç”¨ã™ã‚Œã°åŒç›Ÿæˆ¦åŠ›ã‚‚ã‚­ãƒªç•ªã¨ã‹ã«ã‚‚ã§ãã¾ã™ã®ã§ã€æ…£ã‚ŒãŸã‚‰ã‚„ã£ã¦ã¿ã¦ãã ã•ã„ã€‚</p>
    <p><strong>ã‚ˆãã‚­ãƒ³ã‚°ãƒ€ãƒ é ‚å¤©ãƒ©ã‚¤ãƒ•ã‚’ï¼ï¼</strong></p>
  </div>

  <div id="saveMessage">âœ… ä¿å­˜ã—ã¾ã—ãŸï¼</div>

  <script>
    let memberCount = 3;
    const maxMembers = 4;
    const sawaSerifu = [
      "ç§ã®ä¼ã¯ä»Šã¾ã§ä¸€äººã‚‚æ­»ã‚“ã§ã„ã¾ã›ã‚“",
      "å¼±è€…ã«ã¯å¼±è€…ã®æˆ¦ã„æ–¹ãŒã‚ã‚Šã¾ã™",
      "ã“ã‚Œã¯å‘æ€¯ã§ã¯ãªãæˆ¦æ³•ã§ã™"
    ];

    function showTab(tabName) {
      document.querySelectorAll(".tab-content").forEach(el => el.style.display = "none");
      document.querySelectorAll(".tab").forEach(el => el.classList.remove("active"));
      document.getElementById(tabName).style.display = "block";
      document.querySelector(`.tab[onclick="showTab('${tabName}')"]`).classList.add("active");
    }

    function formatWithCommas(input) {
      input.addEventListener("input", () => {
        let value = input.value.replace(/,/g, "");
        if (value === "" || isNaN(value)) return;
        input.value = Number(value).toLocaleString();
      });
    }

    function createMemberBlock(index, savedName = "", savedPowers = []) {
      const wrapper = document.createElement('div');
      wrapper.className = 'member-block';
      wrapper.id = 'member' + index;

      const title = document.createElement('h2');
      title.textContent = `æ­¦å°†${index}`;
      wrapper.appendChild(title);

      const nameInput = document.createElement('input');
      nameInput.type = 'text';
      nameInput.className = 'nameInput';
      nameInput.placeholder = 'åå‰';
      nameInput.value = savedName || '';
      wrapper.appendChild(nameInput);

      const powersDiv = document.createElement('div');
      powersDiv.className = 'powers';
      for (let i = 0; i < 10; i++) {
        const p = document.createElement('input');
        p.type = 'text';
        p.className = 'powerInput';
        p.placeholder = 'æˆ¦åŠ›';
        p.value = savedPowers[i] || '';
        formatWithCommas(p);
        powersDiv.appendChild(p);
      }
      wrapper.appendChild(powersDiv);

      return wrapper;
    }

    function renderMembers(savedData = []) {
      const container = document.getElementById("members");
      container.innerHTML = "";
      for (let i = 1; i <= memberCount; i++) {
        const saved = savedData[i - 1] || { name: "", powers: [] };
        container.appendChild(createMemberBlock(i, saved.name, saved.powers));
      }
    }

    function addMember() {
      if (memberCount >= maxMembers) return;
      memberCount++;
      renderMembers(getCurrentData());
      if (memberCount === maxMembers) {
        document.querySelector(".add-btn").style.display = "none";
        document.querySelector(".remove-btn").style.display = "inline-block";
      }
    }

    function removeMember() {
      if (memberCount <= 3) return;
      memberCount--;
      renderMembers(getCurrentData());
      if (memberCount < maxMembers) {
        document.querySelector(".add-btn").style.display = "inline-block";
        document.querySelector(".remove-btn").style.display = "none";
      }
    }

    function getCurrentData() {
      return Array.from(document.querySelectorAll(".member-block")).map(div => {
        const name = div.querySelector(".nameInput").value;
        const powers = Array.from(div.querySelectorAll(".powerInput")).map(i => i.value);
        return { name, powers };
      });
    }

    function saveData() {
      const data = {
        target: document.getElementById("targetPower").value,
        placed: document.getElementById("placedPower").value,
        members: getCurrentData(),
        memberCount
      };
      localStorage.setItem("kingdomData", JSON.stringify(data));
      const msg = document.getElementById("saveMessage");
      msg.classList.add("show");
      setTimeout(() => msg.classList.remove("show"), 2000);
    }

    function loadData() {
      const saved = localStorage.getItem("kingdomData");
      if (!saved) {
        renderMembers();
        return;
      }
      const data = JSON.parse(saved);
      memberCount = data.memberCount || 3;
      document.getElementById("targetPower").value = data.target || "";
      document.getElementById("placedPower").value = data.placed || "";
      renderMembers(data.members || []);
      if (memberCount === maxMembers) {
        document.querySelector(".add-btn").style.display = "none";
        document.querySelector(".remove-btn").style.display = "inline-block";
      }
    }

    function checkCombination() {
      document.querySelectorAll(".powerInput").forEach(el => el.classList.remove("highlight"));
      const target = parseInt(document.getElementById("targetPower").value.replace(/,/g,"")) -
                     parseInt(document.getElementById("placedPower").value.replace(/,/g,""));
      const inputs = Array.from(document.querySelectorAll(".powerInput"))
        .map(el => ({ el, value: parseInt(el.value.replace(/,/g,"")) }))
        .filter(x => !isNaN(x.value));

      let found = false;
      let k = (memberCount === 4) ? 4 : 3;

      function combine(arr, k, start = 0, combo = []) {
        if (combo.length === k) {
          const sum = combo.reduce((a, b) => a + b.value, 0);
          if (sum === target && !found) {
            combo.forEach(x => x.el.classList.add("highlight"));
            const resultEl = document.getElementById("result");
            const randomSerifu = sawaSerifu[Math.floor(Math.random() * sawaSerifu.length)];
            resultEl.textContent = randomSerifu;
            resultEl.style.color = "red";
            resultEl.classList.remove("animate");
            void resultEl.offsetWidth; // ã‚¢ãƒ‹ãƒ¡å†ç”Ÿãƒªã‚»ãƒƒãƒˆ
            resultEl.classList.add("animate");
            found = true;
          }
          return;
        }
        for (let i = start; i < arr.length; i++) {
          combine(arr, k, i + 1, combo.concat(arr[i]));
        }
      }
      combine(inputs, k);

      if (!found) {
        const resultEl = document.getElementById("result");
        resultEl.textContent = "ä¸€è‡´ãªã—";
        resultEl.style.color = "white";
        resultEl.classList.remove("animate");
      }
    }

    // åˆæœŸè¨­å®š
    formatWithCommas(document.getElementById("targetPower"));
    formatWithCommas(document.getElementById("placedPower"));
    loadData();
  </script>
</body>
</html>
